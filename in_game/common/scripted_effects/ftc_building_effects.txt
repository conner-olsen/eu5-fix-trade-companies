# Transfers the ownership of a foreign building in a location to the trade company if one 
#  exists in the region
# ROOT: building - the building to change ownership of
ftc_transfer_foreign_building = {
	location.region = {
		save_temporary_scope_as = building_region
	}
	owner = {
		every_subject = {
			limit = {
				has_variable = trade_company_home_region
				var:trade_company_home_region = scope:building_region
			}
			save_temporary_scope_as = new_owner
		}
	}
	change_building_owner = scope:new_owner
}

# Constructs the permanent version of a building after the temporary one is built
# ROOT: building
# ARGS: building_type
ftc_built_temp = {
	location = {
		# destroy temp pop
		every_pop = {
			limit = {
				pop_type = pop_type:temp
			}
			destroy_pop = this
		}
		construct_building = {
			building_type = building_type:$building_type$
			cost_multiplier = 0
			cost_multiplier_reason = "game_concept_foreign_building"
			owner = root.owner
		}
	}
}

# Checks to see if the location has any existing levels
# If it does, we had those levels to the perm and destroy the old one
# If it doesn not, we simply transfer owner ship of this building
# ROOT: building
# ARGS: building_type
ftc_built_perm = {
	location = {
		# destroy temp building
		destroy_all_buildings_of_type = building_type:$building_type$_temp
		# check for existing levels
		every_buildings_in_location = {
			limit = {
				building_type = building_type:$building_type$
				owner = {
					is_subject_of = root.owner
				}
				is_max_level = no
			}
			save_temporary_scope_as = building_to_replace
		}
		# if there are already existing levels, add them to our current level, and destroy the old
		if = {
			limit = {
				exists = scope:building_to_replace
			}
			root = {
				# add old levels to new levels
				change_building_level = scope:building_to_replace.building_level
			}
			# destroy old building
			destroy_building = scope:building_to_replace
		}
	}
	ftc_transfer_foreign_building
}
